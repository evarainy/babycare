<view class="page {{showModal ? 'page-lock' : ''}} {{darkMode ? 'page-dark' : ''}}">
  <view class="date-nav">
    <view class="nav-btn" bindtap="prevDay">â€¹</view>
    <picker mode="date" value="{{currentDate}}" bindchange="onDateChange">
      <view class="date-text">{{currentDate}}</view>
    </picker>
    <view class="nav-btn {{isToday ? 'disabled' : ''}}" bindtap="nextDay">â€º</view>
  </view>

  <view class="day-summary card">
    <view class="summary-item">
      <text class="summary-val">{{daySummary.count}}</text>
      <text class="summary-key">æ¬¡</text>
    </view>
    <view class="summary-item">
      <text class="summary-val">{{daySummary.totalAmount}}</text>
      <text class="summary-key">ml</text>
    </view>
    <view class="summary-item">
      <text class="summary-val">{{daySummary.avgInterval}}</text>
      <text class="summary-key">å¹³å‡é—´éš”</text>
    </view>
  </view>

  <view class="records-list">
    <view wx:if="{{records.length === 0}}" class="empty-state">
      <text>ğŸ¼</text>
      <text>å½“å¤©æš‚æ— è®°å½•</text>
    </view>

    <view class="record-item card" wx:for="{{records}}" wx:key="_id">
      <view class="record-header">
        <view class="flex-row">
          <text class="type-icon">{{item.typeIcon}}</text>
          <view>
            <text class="type-name">{{item.typeLabel}}</text>
            <view class="tags">
              <view class="tag tag-pink" wx:if="{{item.feedingType}}">{{item.feedingType}}</view>
              <view class="tag tag-blue" wx:if="{{item.side}}">{{item.sideLabel}}</view>
              <view class="tag tag-orange" wx:if="{{item.source === 'wechat_bot'}}">ç¾¤èŠ</view>
              <view class="tag tag-green" wx:if="{{item.source === 'siri'}}">Siri</view>
            </view>
          </view>
        </view>
        <view class="record-right">
          <text class="record-amount" wx:if="{{item.amount}}">{{item.amountText}}</text>
          <text class="record-duration" wx:if="{{item.duration}}">{{item.duration}}min</text>
          <text class="record-time-text">{{item.timeText}}</text>
        </view>
      </view>
      <text class="record-note-text" wx:if="{{item.note}}">ğŸ“ {{item.note}}</text>
      <view class="record-footer">
        <text class="interval-text" wx:if="{{item.intervalText}}">è·ä¸Šæ¬¡ {{item.intervalText}}</text>
        <view class="record-ops">
          <text bindtap="editRecord" data-record="{{item}}">ç¼–è¾‘</text>
          <text bindtap="deleteRecord" data-id="{{item._id}}" class="danger">åˆ é™¤</text>
        </view>
      </view>
    </view>
  </view>

  <view class="add-btn-wrap">
    <button class="add-btn" bindtap="showAddModal">+ æ‰‹åŠ¨æ·»åŠ è®°å½•</button>
  </view>
</view>

<view class="edit-modal" wx:if="{{showModal}}" catchtouchmove="noop">
  <view class="modal-mask" bindtap="closeModal" catchtouchmove="noop"></view>
  <view class="modal-body" catchtouchmove="noop">
    <view class="modal-header">
      <text class="modal-title">{{editId ? 'ç¼–è¾‘è®°å½•' : 'æ·»åŠ è®°å½•'}}</text>
      <text class="modal-close" bindtap="closeModal">âœ•</text>
    </view>

    <scroll-view scroll-y class="modal-scroll" enhanced="true" show-scrollbar="false">
      <view class="form-group">
        <text class="form-label">è®°å½•ç±»å‹</text>
        <scroll-view scroll-x class="type-selector-scroll" show-scrollbar="false" enhanced="true">
          <view class="type-selector">
            <view
              class="type-option {{form.type === item.value ? 'active' : ''}}"
              wx:for="{{typeOptions}}"
              wx:key="value"
              bindtap="selectType"
              data-type="{{item.value}}"
            >
              <text>{{item.icon}}</text>
              <text>{{item.label}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <view class="form-group" wx:if="{{form.type === 'breastfeeding'}}">
        <text class="form-label">å–‚å…»ä¾§</text>
        <view class="option-row">
          <view
            class="option-btn {{form.side === item.value ? 'active' : ''}}"
            wx:for="{{sideOptions}}"
            wx:key="value"
            bindtap="selectSide"
            data-side="{{item.value}}"
          >{{item.label}}</view>
        </view>
      </view>

      <view class="form-group" wx:if="{{form.type === 'breastfeeding'}}">
        <text class="form-label">æ—¶é•¿ (åˆ†é’Ÿ)</text>
        <view class="amount-presets">
          <view
            class="preset-btn {{form.duration == item ? 'active' : ''}}"
            wx:for="{{[5, 10, 15, 20, 30]}}"
            wx:key="*this"
            bindtap="selectPresetDuration"
            data-duration="{{item}}"
          >{{item}}</view>
        </view>
        <view class="form-input-wrap"><input class="form-input" type="number" placeholder="è‡ªå®šä¹‰æ—¶é•¿" value="{{form.duration}}" bindinput="onDurationChange" /></view>
      </view>

      <view class="form-group" wx:if="{{form.type === 'bottle'}}">
        <text class="form-label">ç“¶å–‚ç±»å‹</text>
        <view class="option-row">
          <view
            class="option-btn {{form.feedingType === item ? 'active' : ''}}"
            wx:for="{{bottleTypeOptions}}"
            wx:key="*this"
            bindtap="selectFeedingType"
            data-type="{{item}}"
          >{{item}}</view>
        </view>
      </view>

      <view class="form-group" wx:if="{{form.type === 'bottle'}}">
        <text class="form-label">å¥¶é‡ (ml)</text>
        <view class="amount-presets">
          <view
            class="preset-btn {{form.amount == item ? 'active' : ''}}"
            wx:for="{{[60, 80, 100, 120, 150, 180, 200]}}"
            wx:key="*this"
            bindtap="selectPresetAmount"
            data-amount="{{item}}"
          >{{item}}</view>
        </view>
        <view class="form-input-wrap"><input class="form-input" type="number" placeholder="è‡ªå®šä¹‰å¥¶é‡" value="{{form.amount}}" bindinput="onAmountChange" /></view>
      </view>

      <view class="form-group" wx:if="{{form.type === 'food'}}">
        <text class="form-label">è¾…é£Ÿé‡ (g)</text>
        <view class="amount-presets">
          <view
            class="preset-btn {{form.amount == item ? 'active' : ''}}"
            wx:for="{{[10, 20, 30, 50, 80]}}"
            wx:key="*this"
            bindtap="selectPresetAmount"
            data-amount="{{item}}"
          >{{item}}</view>
        </view>
        <view class="form-input-wrap"><input class="form-input" type="number" placeholder="è‡ªå®šä¹‰å…‹æ•°" value="{{form.amount}}" bindinput="onAmountChange" /></view>
      </view>

      <view class="form-group" wx:if="{{form.type === 'swimming' || form.type === 'sleep'}}">
        <text class="form-label">æ—¶é•¿ (åˆ†é’Ÿ)</text>
        <view class="form-input-wrap"><input class="form-input" type="number" placeholder="è¾“å…¥æ—¶é•¿" value="{{form.duration}}" bindinput="onDurationChange" /></view>
      </view>

      <view class="form-group">
        <text class="form-label">è®°å½•æ—¶é—´</text>
        <picker mode="time" value="{{form.timeStr}}" bindchange="onTimeChange">
          <view class="time-picker">{{form.timeStr || 'é€‰æ‹©æ—¶é—´'}}</view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">å¤‡æ³¨</text>
        <textarea class="form-textarea" placeholder="æ·»åŠ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰" value="{{form.note}}" bindinput="onNoteChange" maxlength="120" auto-height="false" />
      </view>
    </scroll-view>

    <view class="modal-footer">
      <button class="btn-secondary" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="submitRecord">æäº¤è®°å½•</button>
    </view>
  </view>
</view>

<voice-floating-button bind:recordsuccess="onVoiceRecordSuccess" />
